<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" name="viewport" content="initial-scale=1.0, width=device-width">
    <title>Invest</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/vue-promise-btn.css" crossorigin="use-credentials">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">

    <!-- jQuery -->
    <script src="/js/jquery.min.js"></script>

    <!-- Cookies -->
    <script src="/js/js.cookie.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DBL3EPC6BC"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());
        gtag('config', 'G-DBL3EPC6BC');
    </script>
</head>
<body>
<router-view></router-view>
<div class="container pb-5" style="padding: 0; max-width: 1376px; width: 100%;">
    <div class="hero-and-solution">
        <section class="hero">
            <%- include("header.ejs", { menu: 2 }) %>
        </section>
    </div>


    <div class="modal fade container-fluid" id="openingModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>Disclaimer</h5>
                </div>
                <div class="modal-body agree">
                    <p>Please read the following terms and conditions and hit agree to continue.<br>I am aware that:</p><hr>
                    <input class="option" type="checkbox" name="foo" value="bar1" id="bar1">
                    <label for="bar1"><span>Cryptocurrency trading can lead to large and immediate financial losses</span></label><br>
                    <input class="option" type="checkbox" name="foo" value="bar2" id="bar2">
                    <label for="bar2"><span>Transactions in cryptocurrency may be irreversible, and losses may not be recoverable</span></label><br>
                    <input class="option" type="checkbox" name="foo" value="bar3" id="bar3">
                    <label for="bar3"><span>The nature of cryptocurrency may lead to an increased risk of fraud or cyber attack</span></label><br>
                    <input class="option" type="checkbox" name="foo" value="bar4" id="bar4">
                    <label for="bar4"><span>HNK Orijent 1919 and Juice d.o.o. are not responsible for my transactions</span></label><br>
                    <input type="checkbox" id="agreeToAll">
                    <label for="agreeToAll"><span style="color: red;">Agree to all</span></label><br>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="document.location.href='/';">Cancel</button>
                    <button type="button" class="btn btn-secondary" disabled data-bs-dismiss="modal" id="confirmModal">Confirm</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Vue dynamic content container -->
    <div id="main">
        <player-bid ref="playerBid"></player-bid>
        <player-shared ref="playerShared"></player-shared>
        <player-shared2 ref="playerShared2"></player-shared2>
    </div>

    <!--
    <div class="cards-container container" style="max-width: 1376px; width: 100%;margin-top:0;">
        <div class="top-disclaimer">
            <h5>This is a preview version</h5>
            <h5>Data may be subject to change</h5>
            <img class="img-fluid disclaimer-image" src="../images/dino-under-construction.png" alt="Dino under construction">
         </div>

        We use simple <template> templating for the example
        <div id="templates" style="display: none">
            <template id="template-balance">
                <tr>
                    <th class="address"></th>
                    <td class="balance"></td>
                </tr>
            </template>
        </div>
    </div>
    -->

    <div id="prepare" style="">
        <button id="btn-connect" style="" class="card-btn gdlr-button">Connect wallet</button>
    </div>



    <div class="container divConnected">
        <div class="row">
            <div class="col-md-12">
                <div id="connected" style="display: none;">
                    <button id="btn-disconnect" class="card-btn gdlr-button">Disconnect wallet</button>
                    <div id="network">
                        <strong>Connected blockchain:</strong> <span id="network-name"></span><br>
                        <strong>Selected account:</strong> <span id="selected-account"></span><br>
                        <strong>Balance on account:</strong> <span id="account-balance"></span>
                    </div>
                    <div>
                        <!--                        <p style="font-weight: bold; color: #a2008d;">Rules: Minimum 1 BNB and Maximum 6 BNB, if you transfer more, the excess amount will not be returned!</p>-->
                        <p id="toLessWarning" style="color: red; font-weight: bold; display: none;">Your account balance is not sufficient enough!</p>

                        <div id="transferForm">

                            <!--                            <label>Pay BNB</label>
                                                        <input id="transferAmount" class="form-control" style="background-color: #f5f5f5; height: 35px; border: 1px solid #acacac; width: 80px;" max="6" min="1" type="number" placeholder="0.0" />

                                                        <label>Receive $NKO Token</label>
                                                        <input id="transferToken" class="form-control" style="background-color: #f5f5f5; height: 35px; border: 1px solid #acacac; width: 120px;" type="number" placeholder="0.0" />

                                                        <button id="btn-contribute" class="gdlr-button">Buy</button>-->

                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="prog">
        <div class="progress">
            <!-- <span class="invested"> Total invested:</span> -->
            <div class="progress-bar progress-bar-striped " role="progressbar"
                 aria-valuenow="<%= invested %>" aria-valuemin="0" aria-valuemax="100" style="width:<%= invested %>%; color: black;"><%= invested %> %
            </div>
            <span class="target">Circulating: 500000 $ORI</span>
        </div>
    </div>

    <% for(var i = 0; i < players.length; i++) { %>
    <div class="card">
        <div class="card-top mt-4">
            <% if(players[i].tag && players[i].tag.name) { %>
            <div class="upcoming-tag" style="background-color: <%= players[i].tag.color %>">
                <span class="tag"><%= players[i].tag.name.toUpperCase()%></span>
            </div>
            <% } %>
                <% if(players[i].tag && players[i].tag.name === "upcoming") { %>
            <img class="card-img-top grey" src="../images/<%= players[i].image %>" alt="Card image cap">
                <% } else { %>
                    <img class="card-img-top" src="../images/<%= players[i].image %>" alt="Card image cap">
                <% } %>
            <% if(players[i].number) { %>
                <div class="player-number">
                   <%= players[i].number %>
                </div>
            <% } %>
        </div>
        <div class="card-body">
            <h5 class="position"><%= players[i].position %></h5>
            <h5 class="card-title mb-3 fw-bold" id="name"><%= players[i].name %> (<%= players[i].age %>)</h5>
            <div class="row">
                <div class="col-8 balance">
                    <p style="color: #595757; font-size: 15px;margin-bottom: 0.1rem;">Balance $ORI</p>
                    <p class="price" id="balance-<%= players[i].modalId %>"><%= players[i].price.balance %></p>
                    <p class="price" id="price-<%= players[i].modalId %>" style="font-size:0.9em;color:#4f4f4f;font-weight:normal;"><%= players[i].price.price %>$</p>
                </div>
                <div class="col-4" >
                    <p style="color: #595757; font-size: 15px;margin-bottom: 0.1rem;">Ch. 24/h</p>
                    <p class="roi" v-bind:style="{ color: players[i].price.profit < 0 ? 'red' : 'green' }" id="roi-<%= players[i].modalId %>"><%= players[i].price.profit %>%</p>
                </div>
            </div>
            <button type="button" class="btn btn-primary invest" onclick="window.openDetails(<%= players[i].modalId %>, '<%= players[i].type %>')"
            <% if(players[i].tag.name === 'upcoming') { %> disabled <% } %>>INVEST</button>
        </div>
    </div>
    <% } %>
    <div style="margin-top: 4em;">
        <%- include("footer.ejs") %>
    </div>
</div>
</body>

<script src="../js/jquery.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="/js/checkboxes.js"></script>
<script src="/js/bootstrap.min.js" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://unpkg.com/web3@1.6.1/dist/web3.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/web3modal@1.9.5/dist/index.js"></script>
<script type="text/javascript" src="https://unpkg.com/evm-chains@0.2.0/dist/umd/index.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/@walletconnect/web3-provider@1.6.6/dist/umd/index.min.js"></script>

<script src="/js/vue.js"></script>
<script src="/js/vue-router.js"></script>
<script src="/js/httpVueLoader.js" crossorigin="use-credentials"></script>
<script type="module" src="/js/vue-promise-btn.umd.js" crossorigin="use-credentials"></script>
<script type="module" src="/vue/app.js" crossorigin="use-credentials"></script>

<script>
    const Web3Modal = window.Web3Modal.default;
    const WalletConnectProvider = window.WalletConnectProvider.default;
    const evmChains = window.evmChains;

    const providerOptions = {
        walletconnect: {
            package: WalletConnectProvider,
            options: {
                rpc: {
                    56: "https://bsc-dataseed1.binance.org"
                }
            }
        }
    }

    window.web3Modal = new Web3Modal({
        cacheProvider: true, // optional
        providerOptions, // required
        disableInjectedProvider: false, // optional. For MetaMask / Brave / Opera.
    });

    const reloadPrice = async () => {
        const req = await fetch("https://apespace.io/_api/token/pairs?id=1087676");
        let ori = await req.json();

        let oriUsd = parseFloat(ori[0].price);

        window.price = parseFloat(oriUsd.toFixed(2));
        document.title = "DeVest - $ORI @ " + oriUsd.toFixed(3) + "$";
    }


    const connect = async () => {
        try {
            window.provider = await window.web3Modal.connect();

            const web3 = new Web3(provider);
            await window.ethereum.request({
                method: 'wallet_switchEthereumChain',
                params: [{ chainId: '0x38' }],
            });

            const chainId = await web3.eth.getChainId();

            // Load chain information over an HTTP API
            const chainData = evmChains.getChain(chainId);
            document.querySelector("#network-name").textContent = chainData.name;
            const accounts = await web3.eth.getAccounts();
            selectedAccount = accounts[0];
            document.querySelector("#selected-account").textContent = selectedAccount;

            // fetch account balance
            const balance = await web3.eth.getBalance(selectedAccount);
            const ethBalance = web3.utils.fromWei(balance, "ether");
            const humanFriendlyBalance = parseFloat(ethBalance).toFixed(4);
            document.querySelector("#account-balance").textContent = humanFriendlyBalance;

            // Display fully loaded UI for wallet data
            document.querySelector("#prepare").style.display = "none";
            document.querySelector("#connected").style.display = "block";
        } catch (e) {
            console.log("Could not get a wallet connection", e);
            return;
        }

    }

    if(localStorage.getItem("WEB3_CONNECT_CACHED_PROVIDER")) {
        (async () => {
            await connect();
            $('#openingModal').modal('show');
        })();
    }

    document.querySelector("#btn-connect").addEventListener("click", async () => {
        $('#openingModal').modal('show');
        await connect();
    });

    document.querySelector("#btn-disconnect").addEventListener("click", async () => {
        if (window.provider.close) {
            await window.provider.close();
            await window.web3Modal.clearCachedProvider();
            localStorage.clear();
            provider = null;
        }

        selectedAccount = null;

        // Set the UI back to the initial state
        document.querySelector("#prepare").style.display = "block";
        document.querySelector("#connected").style.display = "none";
    });



</script>



</html>

